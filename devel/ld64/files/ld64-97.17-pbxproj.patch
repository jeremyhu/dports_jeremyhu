--- ld64.xcodeproj/project.pbxproj.orig	2012-04-28 10:31:20.000000000 -0700
+++ ld64.xcodeproj/project.pbxproj	2012-04-28 10:40:49.000000000 -0700
@@ -536,7 +536,7 @@
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 			shellPath = /bin/bash;
-			shellScript = "if [ -f /Developer/usr/local/include/llvm-c/lto.h ]; then\n\techo \"#define LTO_SUPPORT 1\" > ${DERIVED_FILE_DIR}/configure.h\n\techo \"-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib\" > ${DERIVED_FILE_DIR}/linker_opts\nelse\n\techo \"#undef LTO_SUPPORT\" > ${DERIVED_FILE_DIR}/configure.h\n\techo \"\" > ${DERIVED_FILE_DIR}/linker_opts\nfi\n";
+			shellScript = "if [ -f MACPORTS_LLVM_INCLUDEDIR/llvm-c/lto.h ]; then\n\techo \"#define LTO_SUPPORT 1\" > ${DERIVED_FILE_DIR}/configure.h\n\techo \"-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib\" > ${DERIVED_FILE_DIR}/linker_opts\nelse\n\techo \"#undef LTO_SUPPORT\" > ${DERIVED_FILE_DIR}/configure.h\n\techo \"\" > ${DERIVED_FILE_DIR}/linker_opts\nfi\n";
 			showEnvVarsInLog = 0;
 		};
 		F96D5367094A2754008E9EE8 /* ShellScript */ = {
@@ -713,8 +713,12 @@
 				INSTALL_PATH = /usr/bin;
 				LINKER_DISPLAYS_MANGLED_NAMES = NO;
 				MACOSX_DEPLOYMENT_TARGET = "";
-				OTHER_CPLUSPLUSFLAGS = "$(OTHER_CPLUSPLUSFLAGS)";
-				OTHER_LDFLAGS = "@$(DERIVED_FILE_DIR)/linker_opts";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
+				OTHER_LDFLAGS = (
+					"MACPORTS_LD64_LDFLAGS",
+					"@$(DERIVED_FILE_DIR)/linker_opts",
+				);
 				PREBINDING = NO;
 				PRODUCT_NAME = ld;
 				SECTORDER_FLAGS = "";
@@ -763,9 +767,10 @@
 					"$(DEVELOPER_DIR)/usr/include",
 				);
 				INSTALL_PATH = /usr/bin;
-				OTHER_CPLUSPLUSFLAGS = "$(OTHER_CPLUSPLUSFLAGS)";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				OTHER_LDFLAGS = (
-					"-Wl,-no_pie",
+					"MACPORTS_LD64_LDFLAGS",
 					"@$(DERIVED_FILE_DIR)/linker_opts",
 					"-Wl,-exported_symbol,__mh_execute_header",
 				);
@@ -790,6 +795,8 @@
 				GCC_OPTIMIZATION_LEVEL = 0;
 				HEADER_SEARCH_PATHS = "$(DEVELOPER_DIR)/usr/local/include";
 				INSTALL_PATH = "$(HOME)/bin";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				OTHER_LDFLAGS = "-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib";
 				OTHER_REZFLAGS = "";
 				PREBINDING = NO;
@@ -813,6 +820,8 @@
 				GCC_OPTIMIZATION_LEVEL = s;
 				HEADER_SEARCH_PATHS = "$(DEVELOPER_DIR)/usr/local/include";
 				INSTALL_PATH = "$(HOME)/bin";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				OTHER_LDFLAGS = "-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib";
 				OTHER_REZFLAGS = "";
 				PREBINDING = NO;
@@ -830,6 +839,8 @@
 			buildSettings = {
 				GCC_DYNAMIC_NO_PIC = NO;
 				GCC_TREAT_WARNINGS_AS_ERRORS = NO;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 			};
 			name = Debug;
 		};
@@ -870,6 +881,8 @@
 				GCC_SYMBOLS_PRIVATE_EXTERN = YES;
 				GCC_WARN_ABOUT_MISSING_PROTOTYPES = YES;
 				INSTALL_PATH = /usr/local/lib;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				PREBINDING = NO;
 				PRODUCT_NAME = prunetrie;
 			};
@@ -885,6 +898,8 @@
 				GCC_MODEL_TUNING = G5;
 				GCC_SYMBOLS_PRIVATE_EXTERN = YES;
 				INSTALL_PATH = /usr/local/lib;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				PREBINDING = NO;
 				PRODUCT_NAME = prunetrie;
 			};
@@ -897,6 +912,8 @@
 				GCC_DYNAMIC_NO_PIC = NO;
 				GCC_GENERATE_DEBUGGING_SYMBOLS = YES;
 				GCC_OPTIMIZATION_LEVEL = 0;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				PRODUCT_NAME = all;
 			};
 			name = Debug;
@@ -909,6 +926,8 @@
 				GCC_GENERATE_DEBUGGING_SYMBOLS = NO;
 				PRODUCT_NAME = all;
 				ZERO_LINK = NO;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 			};
 			name = Release;
 		};
@@ -922,6 +941,8 @@
 				GCC_OPTIMIZATION_LEVEL = 0;
 				GCC_WARN_TYPECHECK_CALLS_TO_PRINTF = YES;
 				INSTALL_PATH = "$(HOME)/bin";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				PREBINDING = NO;
 				PRODUCT_NAME = unwinddump;
 			};
@@ -937,6 +958,8 @@
 				GCC_WARN_TYPECHECK_CALLS_TO_PRINTF = YES;
 				HEADER_SEARCH_PATHS = "";
 				INSTALL_PATH = /usr/bin;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				OTHER_LDFLAGS = "-Wl,-exported_symbol,__mh_execute_header";
 				PREBINDING = NO;
 				PRODUCT_NAME = unwinddump;
@@ -965,6 +988,8 @@
 				GCC_WARN_UNUSED_VALUE = YES;
 				GCC_WARN_UNUSED_VARIABLE = YES;
 				INSTALL_PATH = /usr/local/bin;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				PREBINDING = NO;
 				PRODUCT_NAME = dyldinfo;
 				WARNING_CFLAGS = "-Wall";
@@ -981,6 +1006,8 @@
 				GCC_MODEL_TUNING = G5;
 				INSTALL_PATH = /usr/bin;
 				OTHER_LDFLAGS = "-Wl,-exported_symbol,__mh_execute_header";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				PREBINDING = NO;
 				PRODUCT_NAME = dyldinfo;
 				STRIP_INSTALLED_PRODUCT = YES;
@@ -997,6 +1024,8 @@
 				GCC_GENERATE_DEBUGGING_SYMBOLS = YES;
 				GCC_MODEL_TUNING = G5;
 				GCC_OPTIMIZATION_LEVEL = 0;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				INSTALL_PATH = "$(HOME)/bin";
 				PREBINDING = NO;
 				PRODUCT_NAME = machocheck;
@@ -1011,6 +1040,8 @@
 				GCC_GENERATE_DEBUGGING_SYMBOLS = YES;
 				GCC_MODEL_TUNING = G5;
 				HEADER_SEARCH_PATHS = "";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				INSTALL_PATH = "$(HOME)/bin";
 				PREBINDING = NO;
 				PRODUCT_NAME = machocheck;
@@ -1026,6 +1057,8 @@
 				GCC_GENERATE_DEBUGGING_SYMBOLS = YES;
 				GCC_MODEL_TUNING = G5;
 				GCC_OPTIMIZATION_LEVEL = 0;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				INSTALL_PATH = "$(HOME)/bin";
 				PREBINDING = NO;
 				PRODUCT_NAME = rebase;
@@ -1042,6 +1075,8 @@
 				GCC_PREPROCESSOR_DEFINITIONS = "$(GCC_PREPROCESSOR_DEFINITIONS_$(RC_RELEASE))";
 				HEADER_SEARCH_PATHS = "";
 				INSTALL_PATH = /usr/bin;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				OTHER_LDFLAGS = "-Wl,-exported_symbol,__mh_execute_header";
 				PREBINDING = NO;
 				PRODUCT_NAME = rebase;
