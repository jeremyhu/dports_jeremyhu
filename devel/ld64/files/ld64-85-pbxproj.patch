--- ld64.xcodeproj/project.pbxproj.orig	2008-04-29 16:26:12.000000000 -0700
+++ ld64.xcodeproj/project.pbxproj	2012-04-22 12:29:31.000000000 -0700
@@ -350,7 +350,7 @@
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 			shellPath = /bin/bash;
-			shellScript = "if [ -f /Developer/usr/local/include/llvm-c/lto.h ]; then\n\techo \"#define LTO_SUPPORT 1\" > ${DERIVED_FILE_DIR}/configure.h\nelse\n\techo \"#undef LTO_SUPPORT\t\" > ${DERIVED_FILE_DIR}/configure.h\nfi\n";
+			shellScript = "if [ -f MACPORTS_LLVM_INCLUDEDIR/llvm-c/lto.h ]; then\n\techo \"#define LTO_SUPPORT 1\" > ${DERIVED_FILE_DIR}/configure.h\nelse\n\techo \"#undef LTO_SUPPORT\t\" > ${DERIVED_FILE_DIR}/configure.h\nfi\n";
 			showEnvVarsInLog = 0;
 		};
 		F96D5367094A2754008E9EE8 /* ShellScript */ = {
@@ -497,8 +497,9 @@
 				);
 				INSTALL_PATH = /usr/bin;
 				MACOSX_DEPLOYMENT_TARGET = "";
-				OTHER_CPLUSPLUSFLAGS = "$(OTHER_CPLUSPLUSFLAGS)";
-				OTHER_LDFLAGS = "-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
+				OTHER_LDFLAGS = "-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib MACPORTS_LD64_LDFLAGS";
 				PREBINDING = NO;
 				PRODUCT_NAME = ld;
 				SECTORDER_FLAGS = "";
@@ -547,8 +548,9 @@
 					"$(DEVELOPER_DIR)/usr/include",
 				);
 				INSTALL_PATH = /usr/bin;
-				OTHER_CPLUSPLUSFLAGS = "$(OTHER_CPLUSPLUSFLAGS)";
-				OTHER_LDFLAGS = "-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
+				OTHER_LDFLAGS = "-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib MACPORTS_LD64_LDFLAGS";
 				PREBINDING = NO;
 				PRODUCT_NAME = ld;
 				SECTORDER_FLAGS = "";
@@ -568,6 +570,8 @@
 				GCC_OPTIMIZATION_LEVEL = 0;
 				HEADER_SEARCH_PATHS = "$(DEVELOPER_DIR)/usr/include";
 				INSTALL_PATH = "$(HOME)/bin";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				OTHER_LDFLAGS = "-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib";
 				OTHER_REZFLAGS = "";
 				PREBINDING = NO;
@@ -590,6 +594,8 @@
 				GCC_MODEL_TUNING = G5;
 				GCC_OPTIMIZATION_LEVEL = s;
 				INSTALL_PATH = "$(HOME)/bin";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				OTHER_LDFLAGS = "-Wl,-lazy_library,/Developer/usr/lib/libLTO.dylib";
 				OTHER_REZFLAGS = "";
 				PREBINDING = NO;
@@ -607,6 +613,8 @@
 			buildSettings = {
 				GCC_DYNAMIC_NO_PIC = NO;
 				GCC_TREAT_WARNINGS_AS_ERRORS = NO;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 			};
 			name = Debug;
 		};
@@ -616,6 +624,8 @@
 				GCC_DYNAMIC_NO_PIC = NO;
 				GCC_TREAT_WARNINGS_AS_ERRORS = NO;
 				HEADER_SEARCH_PATHS = "$(DEVELOPER_DIR)/SDKs/Extra/usr/include";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 			};
 			name = Release;
 		};
@@ -667,6 +677,8 @@
 				GCC_GENERATE_DEBUGGING_SYMBOLS = YES;
 				GCC_MODEL_TUNING = G5;
 				GCC_OPTIMIZATION_LEVEL = 0;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				INSTALL_PATH = "$(HOME)/bin";
 				PREBINDING = NO;
 				PRODUCT_NAME = machocheck;
@@ -680,6 +692,8 @@
 				DEBUG_INFORMATION_FORMAT = dwarf;
 				GCC_GENERATE_DEBUGGING_SYMBOLS = YES;
 				GCC_MODEL_TUNING = G5;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				INSTALL_PATH = "$(HOME)/bin";
 				PREBINDING = NO;
 				PRODUCT_NAME = machocheck;
@@ -695,6 +709,8 @@
 				GCC_GENERATE_DEBUGGING_SYMBOLS = YES;
 				GCC_MODEL_TUNING = G5;
 				GCC_OPTIMIZATION_LEVEL = 0;
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				INSTALL_PATH = "$(HOME)/bin";
 				PREBINDING = NO;
 				PRODUCT_NAME = rebase;
@@ -709,6 +725,8 @@
 				GCC_GENERATE_DEBUGGING_SYMBOLS = YES;
 				GCC_MODEL_TUNING = G5;
 				GCC_PREPROCESSOR_DEFINITIONS = "$(GCC_PREPROCESSOR_DEFINITIONS_$(RC_RELEASE))";
+				OTHER_CFLAGS = "MACPORTS_CFLAGS";
+				OTHER_CPLUSPLUSFLAGS = "MACPORTS_CPLUSPLUSFLAGS";
 				INSTALL_PATH = /usr/bin;
 				PREBINDING = NO;
 				PRODUCT_NAME = rebase;
